<div
  data-animate-in
  class              = "widget-themis-finish portlet box blue"
  data-ng-controller = "ControllerWidgetExerciseBuilder">

  <div class="portlet-title">
    <h4><span>Template Manager</span></h4>
  </div>

  <div
    data-ng-init = "viewModel.templatesListCollapsed = false"
    class        = "portlet-body light-grey">
    <div class="row-fluid">

      <!-- Templates list -->
      <div
        data-ng-hide = "viewModel.templatesListCollapsed && viewModel.routeParams.revisionUid"
        class        = "span5 responsive span8">
        <div
          id           = "templatesListPortlet"
          data-ng-show = "!viewModel.templatesListCollapsed"
          class        = "portlet box grey">
          <div class="portlet-title">
            <h4><span>Templates</span></h4>
          </div>
          <!-- portlet body -->
          <div class="portlet-body light-grey">

            <button
              style           = "margin-bottom: 5px;"
              data-ng-hide    = "viewModel.showAddNewTemplate"
              data-ng-animate = "{show: 'fadeIn', hide: 'fadeOut'}"
              data-ng-click   = "viewModel.showAddNewTemplate=true;"
              class           = "btn green btn-block">Add Template <i class="m-icon-swapright m-icon-white"></i></button>

            <table
                  class                                  = "table table-striped table-hover table-bordered dataTable"
                  data-data-table                        = "viewModel.templatesListDataTable.options"
                  data-aa-data                           = "viewModel.templates"
                  data-ao-column-defs                    = "viewModel.templatesListDataTable.columnDefs"
                  data-parent-data-table-view-model-prop = "templatesListDataTable"
                  update-on-resource-post                = "template"
                  data-fn-row-callback                   = "">
              <thead>
              <tr>
                  <th class = "sorting">Name</th>
                  <th class = "sorting">Type</th>
                  <th class = "sorting_disabled"></th>
              </tr>
              </thead>
            </table>

            <button
              style           = "margin-bottom: 5px;"
              data-ng-hide    = "viewModel.showAddNewTemplate"
              data-ng-animate = "{show: 'fadeIn', hide: 'fadeOut'}"
              data-ng-click   = "viewModel.showAddNewTemplate=true;"
              class           = "btn btn-block">Show Archived <i class="m-icon-swapdown"></i></button>


          </div><!-- /portlet body -->
        </div>
      </div><!-- /Templates list -->

      <div
        data-ng-class = "{true:'span12 no-second-box-margin', false:'span7'}[(viewModel.templatesListCollapsed && viewModel.routeParams.revisionUid)]"
        class = "">



        <div
          data-ng-include = "'viewPartialExerciseBuilderNewTemplateForm'">
        </div>




        <div class="portlet box grey">
          <div class="portlet-title">

            <div class="caption pull-left">
              <h4><span>Edit Revision</span></h4>
            </div>



            <div
              data-ng-show = "viewModel.routeParams.revisionUid"
              style        = "margin:0;"
              class        = "tools pull-right">
              <a
                data-ng-click = "viewModel.toggleTemplatesListCollapsed()"
                class         = "btn mini blue">
                <p
                  data-ng-hide = "viewModel.templatesListCollapsed"
                  style="margin:0;"><i class="halflings-icon white chevron-left"></i><span style="vertical-align:bottom; font-size:14px;"></span></p>
                <p
                  data-ng-show = "viewModel.templatesListCollapsed"
                  style="margin:0;"><span style="vertical-align:bottom; font-size:14px;"></span><i class="halflings-icon white chevron-right"></i></p>
              </a>
            </div>




            <div class="clearfix"></div>

          </div>
          <!-- portlet body -->
          <div class="portlet-body light-grey">



            <div data-ng-hide = "viewModel.routeParams.templateUid">
              <div class="box template-info-box fade in ng-scope">
                <div class="inline-content">
                  <strong><i style="vertical-align:middle; margin-top:0;" class="m-icon-big-swapleft"></i></strong><h3>Select Template Revision</h3>
                </div>
              </div>
            </div>


            <div data-ng-show = "resourcePool[viewModel.routeParams.templateUid]">

              <div class="box template-info-box fade in">

                <div class="row-fluid">
                  <div class="span12">

                    <h2
                      data-ng-hide = "viewModel.showEditTemplateName"
                      style="margin-top:0;"><span>{{resourcePool[viewModel.routeParams.templateUid].name}}</span></h2>


                    <form
                      name         = "formEditTemplateName"
                      data-ng-show = "viewModel.showEditTemplateName"
                      class        = "form-horizontal" novalidate>
                      <div
                        data-ng-class = "{success:formEditTemplateName.name.$valid, error:!formEditTemplateName.name.$valid, 'ng-pristine':formEditTemplateName.name.$pristine}"
                        class         = "control-group">

                        <div class="row-fluid">
                          <div class="span6">
                            <input
                              name              = "name"
                              data-ng-model     = "viewModel.formEditTemplateName.name"
                              data-ng-minlength = "{{clientOrmShare.template.model.name.validate.len[0]}}"
                              data-ng-maxlength = "{{clientOrmShare.template.model.name.validate.len[1]}}"
                              data-unique-field = '{"resource": "template", "property": "name"}'
                              type              = "text"
                              class             = "span12 m-wrap"/>

                            <span
                              data-ng-show="formEditTemplateName.name.$error.minlength"
                              class="help-inline">Name must be longer than {{clientOrmShare.template.model.name.validate.len[0]}} characters</span>

                            <span
                              data-ng-show="formEditTemplateName.name.$error.maxlength"
                              class="help-inline">Name must be shorter than {{clientOrmShare.template.model.name.validate.len[1]}} characters</span>

                            <span
                              data-ng-show="formEditTemplateName.name.$error.uniqueField"
                              class="help-inline">A template with the name "{{viewModel.formEditTemplateName.name}}" already exists</span>

                          </div>
                          <div class="span6">
                            <button
                              style            = "margin-bottom: 5px;"
                              data-ng-disabled = "formEditTemplateName.$invalid"
                              data-ng-click    = "viewModel.putTemplate(viewModel.routeParams.templateUid)"
                              class            = "btn btn-block green span6"><i class="icon-save m-icon-white"></i> Save</button>
                            <button
                              style            = "margin-bottom: 5px; margin-top: 0;"
                              data-ng-click    = "viewModel.showEditTemplateName = false; formEditTemplateName.$setPristine(); viewModel.formEditTemplateName.name=viewModel.currentTemplate.name;"
                              class            = "btn red btn-block span6"><i class="icon-remove m-icon-white"></i> Cancel</button>
                          </div>

                        </div>

                      </div>
                    </form>



                  </div><!-- span 12 -->
                </div><!-- row-fluid -->

                <div class="row-fluid">
                  <div class="span6">
                    <button
                      style           = "margin-bottom: 5px;"
                      data-ng-hide    = "viewModel.showEditTemplateName"
                      data-ng-animate = "{show: 'fadeIn', hide: 'fadeOut'}"
                      data-ng-click   = "viewModel.showEditTemplateName=true; viewModel.formEditTemplateName.name = resourcePool[viewModel.routeParams.templateUid].name;"
                      class           = "btn blue btn-block"><i class="icon-pencil m-icon-white"></i> Edit Name</button>
                  </div>
                  <div class="span6">
                    <button
                      style           = "margin-bottom: 5px;"
                      data-ng-hide    = "viewModel.showAddNewTemplateGroup"
                      data-ng-animate = "{show: 'fadeIn', hide: 'fadeOut'}"
                      data-ng-click   = "viewModel.showAddNewTemplateGroup=true;"
                      class           = "btn green btn-block">Add Group <i class="m-icon-swapright m-icon-white"></i></button>
                  </div>
                </div>

              </div>


              <div
                data-ng-include = "'viewPartialExerciseBuilderNewGroupForm'">
              </div>

              <ul class="breadcrumb">
                <li>
                  <i class="icon-home"></i>
                    <a>Groups</a>
                  <i class="icon-angle-right"></i>
                </li>
              </ul>

              <!-- loading indicator, shown during groups loading -->
              <div
                data-ng-hide = "resourcePool[viewModel.routeParams.templateUid].revisions[viewModel.routeParams.revisionUid].groups">
                <div class="progress progress-striped active">
                   <div style="width: 100%;" class="bar"></div>
                </div>
              </div>


              <div
                data-ng-repeat = "group in resourcePool[viewModel.routeParams.templateUid].revisions[viewModel.routeParams.revisionUid].groups | toArray | deleted | orderBy:'ordinal':false"
                data-ng-init   = "nameEditing=false;"
                data-group-uid = "{{group.uid}}">

                <div data-ng-controller="ControllerWidgetExerciseBuilderGroupEdit" class="template-builder-group">

                  <div
                    class           = "navbar"
                    style           = "margin-bottom:0;"
                    data-ng-include = "'viewPartialExerciseBuilderGroupMenu'"></div>

                  <div
                    style = "border-top:0px;"
                    class = "box template-info-box fade in">

                    <div
                      style           = "margin-bottom:10px;"
                      data-ng-show    = "viewModel.showAddNewField_OpenType == ''"
                      data-ng-animate = "{show:'fadeIn'}"
                      class           = "inline-content">
                      <strong>
                        <i style="vertical-align:middle; margin-top:0;" class="m-icon-big-swapup"></i>
                      </strong>
                      <h3>Add Fields To Exercise Group</h3>
                    </div>







                    <!-- new field forms -->
                    <div
                      data-ng-controller = "ControllerWidgetExerciseBuilderGroupFieldOpenResponse"
                      style              = "display:none;"
                      data-ng-animate    = "{show: 'slideDown', hide: 'slideUp'}"
                      data-ng-show       = "viewModel.showAddNewField_OpenType == 'OpenResponse'"
                      data-ng-class      = "{'green sub-portlet':formOpenResponseAdd.$valid, 'grey':formOpenResponseAdd.$invalid}"
                      class              = "portlet box">
                      <div class="portlet-title">
                        <h4><span>New <strong>Open Response</strong> Field</span></h4>
                      </div>
                      <div class = "portlet-body light-grey">
                        <form
                          name            = "formOpenResponseAdd"
                          class           = "form-horizontal"
                          data-ng-include = "'viewPartialExerciseBuilderGroupFieldOpenResponse'"
                          novalidate></form>

                        <div data-ng-include="'viewWidgetExerciseBuilderFieldButtons'"></div>

                      </div>
                    </div>

                    <div
                      data-ng-controller = "ControllerWidgetExerciseBuilderGroupFieldSelectIndividual"
                      style              = "display:none;"
                      data-ng-animate    = "{show: 'slideDown', hide: 'slideUp'}"
                      data-ng-show       = "viewModel.showAddNewField_OpenType == 'SelectIndividual'"
                      data-ng-class      = "{'green sub-portlet':formSelectIndividualAdd.$valid, 'grey':formSelectIndividualAdd.$invalid}"
                      class              = "portlet box">
                      <div class="portlet-title">
                        <h4><span>New <strong>Select Individual</strong> Field</span></h4>
                      </div>
                      <div class = "portlet-body light-grey">

                        <form
                          name            = "formSelectIndividualAdd"
                          class           = "form-horizontal"
                          data-ng-include = "'viewPartialExerciseBuilderGroupFieldSelectIndividual'"
                          novalidate></form>

                        <div data-ng-include="'viewWidgetExerciseBuilderFieldButtons'"></div>

                      </div>
                    </div>

                    <div
                      data-ng-controller = "ControllerWidgetExerciseBuilderGroupFieldSelectMultiple"
                      style              = "display:none;"
                      data-ng-animate    = "{show: 'slideDown', hide: 'slideUp'}"
                      data-ng-show       = "viewModel.showAddNewField_OpenType == 'SelectMultiple'"
                      data-ng-class      = "{'green sub-portlet':formSelectMultipleAdd.$valid, 'grey':formSelectMultipleAdd.$invalid}"
                      class              = "portlet box">
                      <div class="portlet-title">
                        <h4><span>New <strong>Select Multiple</strong> Field</span></h4>
                      </div>
                      <div class = "portlet-body light-grey">
                        <form
                          name            = "formSelectMultipleAdd"
                          class           = "form-horizontal"
                          data-ng-include = "'viewPartialExerciseBuilderGroupFieldOpenResponse'"
                          novalidate></form>

                        <div data-ng-include="'viewWidgetExerciseBuilderFieldButtons'"></div>

                      </div>
                    </div>

                    <div
                      data-ng-controller = "ControllerWidgetExerciseBuilderGroupFieldYesNo"
                      style              = "display:none;"
                      data-ng-animate    = "{show: 'slideDown', hide: 'slideUp'}"
                      data-ng-show       = "viewModel.showAddNewField_OpenType == 'YesNo'"
                      data-ng-class      = "{'green sub-portlet':formYesNoAdd.$valid, 'grey':formYesNoAdd.$invalid}"
                      class              = "portlet box">
                      <div class="portlet-title">
                        <h4><span>New <strong>Yes/No</strong> Field</span></h4>
                      </div>
                      <div class = "portlet-body light-grey">
                        <form
                          name            = "formYesNoAdd"
                          class           = "form-horizontal"
                          data-ng-include = "'viewPartialExerciseBuilderGroupFieldOpenResponse'"
                          novalidate></form>

                        <div data-ng-include="'viewWidgetExerciseBuilderFieldButtons'"></div>

                      </div>
                    </div>

                    <div
                      data-ng-controller = "ControllerWidgetExerciseBuilderGroupFieldPercentageSlider"
                      style              = "display:none;"
                      data-ng-animate    = "{show: 'slideDown', hide: 'slideUp'}"
                      data-ng-show       = "viewModel.showAddNewField_OpenType == 'PercentageSlider'"
                      data-ng-class      = "{'green sub-portlet':formPercentageSliderAdd.$valid, 'grey':formPercentageSliderAdd.$invalid}"
                      class              = "portlet box">
                      <div class="portlet-title">
                        <h4><span>New <strong>Percentage Slider</strong> Field</span></h4>
                      </div>
                      <div class = "portlet-body light-grey">
                        <form
                          name            = "formPercentageSliderAdd"
                          class           = "form-horizontal"
                          data-ng-include = "'viewPartialExerciseBuilderGroupFieldOpenResponse'"
                          novalidate></form>

                        <div data-ng-include="'viewWidgetExerciseBuilderFieldButtons'"></div>

                      </div>
                    </div>
                    <!-- / new field forms -->







                    <form class="form-horizontal template-builder-form">

                      <div
                        data-ui-sortable = "fieldsSortableOptions">

                        <div
                          data-ng-repeat = "field in group.fields | toArray | orderBy:'ordinal'"
                          data-field-uid = "{{field.uid}}">
                          <div
                            data-ng-switch="field.type">


                            <div class="portlet box grey">
                              <div class="portlet-title">

                                <div class="caption">
                                  <h4 style="margin-bottom:0 !important;" class="inline-content">
                                    <i class="icon-reorder"></i>

                                    <div class="btn-group">
                                      <a class="btn blue" href="#" data-toggle="dropdown">
                                      Field Options
                                      <i style="color:#FFF;" class="icon-angle-down"></i>
                                      </a>
                                      <ul class="dropdown-menu">
                                         <li><a href="#"><i class="icon-pencil"></i> Edit</a></li>
                                         <li ><a class="color-red" href="#"><i class="icon-trash"></i> Delete</a></li>
                                      </ul>
                                    </div><!-- btn-group -->

                                    <span style="color:#FFF !important;">{{field.name}}</span>
                                  </h4>
                                </div><!-- caption -->

                              </div><!-- portlet-title -->
                              <div style="background-color:#FFF; padding:10px 0 10px 0;" class="portlet-body">


                                <div class="box template-info-box fade in">Field Info Goes Here?</div>

                                <div
                                  data-ng-switch-when="openResponse">

                                  <div class="control-group">
                                     <label class="control-label">{{field.name}}</label>
                                     <div class="controls">
                                        <input data-ng-disabled="true" type="text" placeholder="" class="m-wrap medium">
                                        <span class="help-inline"></span>
                                     </div>
                                  </div>

                                </div><!-- openResponse -->


                                <div
                                  data-ng-switch-when="selectIndividual">
                                </div><!-- selectIndividual -->

                                <div
                                  data-ng-switch-when="selectMultiple">
                                </div><!-- selectMultiple -->

                                <div
                                  data-ng-switch-when="yesNo">
                                </div><!-- yesNo -->

                                <div
                                  data-ng-switch-when="percentageSlider">
                                </div><!-- percentageSlider -->


                              </div><!-- portlet-body -->
                            </div><!-- portlet-box -->




                          </div><!-- data-ng-switch="field.type" -->
                        </div><!-- data-ng-repeat = "field in group.fields" -->
                      </div>
                    </form>




                  </div><!-- template-info-box -->


                </div><!-- controller: ControllerWidgetExerciseBuilderGroupEdit -->

              </div><!-- data-ng-repeat -->



            </div><!-- /exercise editor -->


          </div><!-- /portlet body -->
        </div>
      </div><!-- /Current Template -->
    </div>
  </div>
</div>



